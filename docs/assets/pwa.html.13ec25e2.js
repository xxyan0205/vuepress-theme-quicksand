import{r as n,o as s,c as a,a as e,w as p,F as t,b as o,d as l}from"./app.48991ef1.js";const r={},c=e("h1",{id:"pwa",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#pwa","aria-hidden":"true"},"#"),o(" pwa")],-1),i=o("使你的 VuePress 站点成为一个 "),u={href:"https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps",target:"_blank",rel:"noopener noreferrer"},k=o("渐进式 Web 应用 (PWA)"),b=o("."),d=o("该插件使用 "),m={href:"https://developers.google.com/web/tools/workbox/modules/workbox-build",target:"_blank",rel:"noopener noreferrer"},g=o("workbox-build"),h=o(" 来生成 Service Worker 文件，并通过 "),v={href:"https://github.com/yyx990803/register-service-worker",target:"_blank",rel:"noopener noreferrer"},f=o("register-service-worker"),q=o(" 来注册 Service Worker 。"),w=e("h2",{id:"web-app-manifests",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#web-app-manifests","aria-hidden":"true"},"#"),o(" Web App Manifests")],-1),y=o("为了使你的网站符合 PWA 的要求，你需要创建一个 "),W={href:"https://developer.mozilla.org/zh-CN/docs/Web/Manifest",target:"_blank",rel:"noopener noreferrer"},x=o("Web app manifests"),_=o(" 文件，并且为你的 PWA 设置图标、颜色等信息。"),S=o("你需要将你的 Manifest 文件和图标放置在 "),P=o("Public 目录"),z=o(" 下。在下述的示例中，我们假设你正在使用默认的 Public 目录 "),j=e("code",null,".vuepress/public",-1),A=o(" 。"),E=l('<ol><li>创建 Manifest 文件</li></ol><p>通常是 <code>.vuepress/public/manifest.webmanifest</code> ：</p><div class="theme-code-dark"><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VuePress&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VuePress&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Vue-powered Static Site Generator&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#3eaf7c&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/images/icons/android-chrome-192x192.png&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192x192&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/images/icons/android-chrome-384x384.png&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;384x384&quot;</span><span class="token punctuation">,</span>\n      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></div><ol start="2"><li>生成 PWA 图标</li></ol><p>为了提高你的 PWA 的可用性，你需要生成一些图标，并将它们放置在 Public 目录下。</p><p>确保图标的路径匹配 Manifest 文件中的 <code>icons</code> 字段：</p><ul><li><code>.vuepress/public/images/icons/android-chrome-192x192.png</code></li><li><code>.vuepress/public/images/icons/android-chrome-384x384.png</code></li></ul>',7),M={class:"custom-container tip"},B=e("p",{class:"custom-container-title"},"提示",-1),C=o("一些工具可以帮助你做这些事。比如 "),V={href:"https://realfavicongenerator.net/",target:"_blank",rel:"noopener noreferrer"},F=o("Favicon Generator"),G=o(" 可以帮助你生成图片以及一个 Manifest 文件样例。"),I=e("ol",{start:"3"},[e("li",null,"设置 Head 中的标签")],-1),N=o("你还需要通过 "),R=o("head"),D=o(" 配置项来设置一些标签，用来 "),L={href:"https://developer.mozilla.org/en-US/docs/Web/Manifest#deploying_a_manifest_with_the_link_tag",target:"_blank",rel:"noopener noreferrer"},U=o("部署你的 Manifest 文件"),H=o(" 。"),O=l('<div class="theme-code-dark"><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  head<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span><span class="token string">&#39;link&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> rel<span class="token operator">:</span> <span class="token string">&#39;manifest&#39;</span><span class="token punctuation">,</span> href<span class="token operator">:</span> <span class="token string">&#39;/manifest.webmanifest&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token string">&#39;meta&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;theme-color&#39;</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">&#39;#3eaf7c&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token comment">// ...其他标签</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><h2 id="配置项" tabindex="-1"><a class="header-anchor" href="#配置项" aria-hidden="true">#</a> 配置项</h2>',2),J=o("该插件的配置项可以接收 workbox-build 中 "),K={href:"https://developers.google.com/web/tools/workbox/reference-docs/latest/module-workbox-build#.generateSW",target:"_blank",rel:"noopener noreferrer"},Q=o("generateSW 方法"),T=o(" 除了 "),X=e("code",null,"globDirectory",-1),Y=o(" 和 "),Z=e("code",null,"swDest",-1),$=o(" 以外的所有参数。"),nn=l('<p>比如，你可以设置 <code>skipWaiting: true</code> ，这将在新的 Service Worker 就绪之后立即激活它：</p><div class="theme-code-dark"><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">[</span>\n      <span class="token string">&#39;@vuepress/pwa&#39;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        skipWaiting<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><p>但是如果你不设置 <code>skipWaiting</code> 或设置为 <code>false</code> ，你就需要手动激活新的 Service Worker 。</p>',3),sn=o("对于用户，你可以配合我们提供的 "),an=o("pwa-popup"),en=o(" 插件一起使用。"),pn=e("li",null,[o("对于开发者，你可以使用该插件提供的 "),e("a",{href:"#composition-api"},"Composition API"),o(" 来控制 Service Worker 的行为。")],-1),tn=e("h3",{id:"serviceworkerfilename",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#serviceworkerfilename","aria-hidden":"true"},"#"),o(" serviceWorkerFilename")],-1),on=e("li",null,[e("p",null,[o("类型： "),e("code",null,"string")])],-1),ln=e("li",null,[e("p",null,[o("默认值： "),e("code",null,"'service-worker.js'")])],-1),rn=e("p",null,"详情：",-1),cn=o("生成的 Service Worker 文件路径，该路径是 "),un=o("dest"),kn=o(" 目录的相对路径。"),bn=e("p",null,[o("Service Worker 文件只会在 "),e("code",null,"build"),o(" 模式下生成。")],-1),dn=e("h2",{id:"composition-api",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#composition-api","aria-hidden":"true"},"#"),o(" Composition API")],-1),mn=e("h3",{id:"usepwaevent",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#usepwaevent","aria-hidden":"true"},"#"),o(" usePwaEvent")],-1),gn=e("p",null,"详情：",-1),hn=e("p",null,"返回该插件的 Event Emitter 。",-1),vn=o("你可以为 "),fn={href:"https://github.com/yyx990803/register-service-worker",target:"_blank",rel:"noopener noreferrer"},qn=o("register-service-worker"),wn=o(" 提供的事件添加事件监听器。"),yn=e("li",null,[e("p",null,"示例：")],-1),Wn=l('<div class="theme-code-dark"><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> usePwaEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/plugin-pwa/lib/client&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token function">usePwaEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;ready&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Service worker 已经生效。&#39;</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><h3 id="useskipwaiting" tabindex="-1"><a class="header-anchor" href="#useskipwaiting" aria-hidden="true">#</a> useSkipWaiting</h3><ul><li>参数：</li></ul><table><thead><tr><th>参数</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>registration</td><td><code>ServiceWorkerRegistration</code></td><td>你想要激活的 Service Worker 的 Registration</td></tr></tbody></table>',4),xn=e("p",null,"详情：",-1),_n=o("调用 "),Sn={href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/skipWaiting",target:"_blank",rel:"noopener noreferrer"},Pn=o("skipWaiting()"),zn=o(" 来激活处于 Waiting 状态的 Service Worker 。"),jn=e("li",null,[e("p",null,"示例：")],-1),An=l('<div class="theme-code-dark"><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>\n  usePwaEvent<span class="token punctuation">,</span>\n  useSkipWaiting<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/plugin-pwa/lib/client&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token function">usePwaEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;updated&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;在 Waiting 状态的 Service Worker 已经就绪。&#39;</span><span class="token punctuation">)</span>\n      <span class="token comment">// 激活 Waiting 状态的 Service Worker</span>\n      <span class="token function">useSkipWaiting</span><span class="token punctuation">(</span>registration<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div>',1);r.render=function(o,l){const r=n("NpmBadge"),En=n("OutboundLink"),Mn=n("RouterLink");return s(),a(t,null,[c,e(r,{package:"@vuepress/plugin-pwa"}),e("p",null,[i,e("a",u,[k,e(En)]),b]),e("p",null,[d,e("a",m,[g,e(En)]),h,e("a",v,[f,e(En)]),q]),w,e("p",null,[y,e("a",W,[x,e(En)]),_]),e("p",null,[S,e(Mn,{to:"/zh/guide/assets.html#public-%E6%96%87%E4%BB%B6"},{default:p((()=>[P])),_:1}),z,j,A]),E,e("div",M,[B,e("p",null,[C,e("a",V,[F,e(En)]),G])]),I,e("p",null,[N,e(Mn,{to:"/zh/reference/config.html#head"},{default:p((()=>[R])),_:1}),D,e("a",L,[U,e(En)]),H]),O,e("p",null,[J,e("a",K,[Q,e(En)]),T,X,Y,Z,$]),nn,e("ul",null,[e("li",null,[sn,e(Mn,{to:"/zh/reference/plugin/pwa-popup.html"},{default:p((()=>[an])),_:1}),en]),pn]),tn,e("ul",null,[on,ln,e("li",null,[rn,e("p",null,[cn,e(Mn,{to:"/zh/reference/config.html#dest"},{default:p((()=>[un])),_:1}),kn]),bn])]),dn,mn,e("ul",null,[e("li",null,[gn,hn,e("p",null,[vn,e("a",fn,[qn,e(En)]),wn])]),yn]),Wn,e("ul",null,[e("li",null,[xn,e("p",null,[_n,e("a",Sn,[Pn,e(En)]),zn])]),jn]),An],64)};export default r;
